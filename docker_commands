# build
docker build . -t vllm

# run
docker run -ti --rm -e CUDA_DEVICE_ORDER \
    -e HF_HOME=/scratch/tannon/cache/huggingface \
    -e TRANSFORMERS_CACHE=/scratch/tannon/cache/huggingface \
    -e HF_DATASETS_CACHE=/scratch/tannon/cache/huggingface \
    -e TORCH_HOME=/scratch/tannon/cache/torch \
    -e MPLCONFIGDIR=/scratch/tannon/cache/matplotlib \
    -e WANDB_CACHE_DIR=/scratch/tannon/cache/wandb \
    -e WANDB_CONFIG_DIR=/scratch/tannon/cache/wandb \
    -e TORCH_EXTENSIONS_DIR=/scratch/tannon/cache/torch_extensions \
    -e TMPDIR=/scratch/tannon/tmp \
    --user $(id -u):$(id -g) \
    --memory="850g" \
    --shm-size="8g" \
    --ipc=host \
    --ulimit stack=67108864 \
    -v /etc/passwd:/etc/passwd:ro -v /etc/group:/etc/group:ro -v /etc/shaddow:/etc/shaddow:ro \
    -v $(pwd -P):$(pwd -P) \
    -v /scratch/tannon:/scratch/tannon/ \
    -v /mnt/play/tannon:/mnt/play/tannon/ \
    -w $(pwd -P) \
    --gpus 'all' \
    --name mllm mllm
